<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>EduNova - AI-Powered Inclusive Learning</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* ---------- Base ---------- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root{
            --primary: #4361ee;
            --primary-dark: #3a0ca3;
            --secondary: #f72585;
            --accent: #4cc9f0;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --success: #4bb543;
            --border: #dee2e6;
            --card-shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
            --hover-shadow: 0 20px 25px -5px rgba(67,97,238,0.15);
        }
        body { font-family: 'Inter', sans-serif; background-color: #f9fafb; color: var(--dark); line-height: 1.6; }
        .container { width:100%; max-width:1200px; margin:0 auto; padding:0 1rem; }

        /* ---------- Header & Nav ---------- */
        header { background-color: white; box-shadow: 0 2px 10px rgba(0,0,0,0.1); position: sticky; top:0; z-index:100; }
        .nav-container { display:flex; justify-content:space-between; align-items:center; padding:1rem 0; }
        .logo { display:flex; align-items:center; gap:.5rem; font-weight:700; font-size:1.5rem; color:var(--primary); }
        .nav-links { display:flex; gap:2rem; }
        .nav-links a { text-decoration:none; color:var(--dark); font-weight:500; transition:color .3s; }
        .nav-links a:hover { color:var(--primary); }
        .mobile-menu-btn { display:none; background:none; border:none; font-size:1.5rem; cursor:pointer; color:var(--dark); }

        /* Mobile Nav Open State */
        @media(max-width:768px){
            .nav-links { 
                display: none; 
                flex-direction: column;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background-color: white;
                padding: 1rem;
                box-shadow: 0 5px 10px rgba(0,0,0,0.1);
                gap: 1rem;
            }
            .nav-links.active { 
                display: flex; 
            }
            .mobile-menu-btn{ display:block; }
            .hero-title{ font-size:2.5rem; }
            .sidebar{ flex:0 0 100%; }
        }

        /* ---------- Hero ---------- */
        .hero { position:relative; padding:6rem 1rem; background:linear-gradient(135deg,#f5f7fa 0%,#c3cfe2 100%); overflow:hidden; }
        .hero::before{ content:''; position:absolute; inset:0; background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32' width='32' height='32' fill='none' stroke='rgb(67 97 238 / 0.05)'%3e%3cpath d='M0 .5H31.5V32'/%3e%3c/svg%3e"); z-index:1; }
        .hero-content{ position:relative; z-index:2; text-align:center; max-width:800px; margin:0 auto; }
        .hero-badge{ display:inline-flex; align-items:center; gap:.5rem; background:white; padding:.5rem 1rem; border-radius:50px; margin-bottom:1.5rem; box-shadow:0 4px 6px rgba(0,0,0,0.05); }
        .hero-title{ font-size:3.5rem; font-weight:800; margin-bottom:1rem; background:linear-gradient(to right,var(--primary),var(--secondary)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
        .hero-subtitle{ font-size:1.25rem; color:var(--gray); margin-bottom:2rem; }
        .hero-actions{ display:flex; gap:1rem; justify-content:center; flex-wrap:wrap; }

        /* ---------- Buttons ---------- */
        .btn{ display:inline-flex; align-items:center; justify-content:center; padding:.75rem 1.5rem; border-radius:.5rem; font-weight:600; text-decoration:none; transition:all .3s ease; border:none; cursor:pointer; gap:.5rem; }
        .btn-primary{ background:var(--primary); color:white; }
        .btn-primary:hover{ background:var(--primary-dark); transform:translateY(-2px); box-shadow:var(--card-shadow); }
        .btn-secondary{ background:white; color:var(--primary); border:1px solid var(--border); }
        .btn-secondary:hover{ background:#f8f9fa; transform:translateY(-2px); box-shadow:var(--card-shadow); }
        /* Focus styles for accessibility */
        .btn:focus-visible, .chat-input input:focus-visible, .option-button:focus-visible, .language-option:focus-visible { 
            outline: 2px solid var(--primary); 
            outline-offset: 2px; 
        }

        /* ---------- Sections ---------- */
        .section { padding:5rem 1rem; }
        .section-title { text-align:center; font-size:2.5rem; font-weight:700; margin-bottom:1rem; }
        .section-subtitle { text-align:center; color:var(--gray); max-width:600px; margin:0 auto 3rem; }

        /* ---------- Dashboard ---------- */
        .dashboard { display:flex; gap:2rem; flex-direction:column; }
        @media(min-width:992px){ .dashboard{ flex-direction:row; } }
        .sidebar { flex:0 0 300px; background:white; border-radius:1rem; padding:1.5rem; box-shadow:var(--card-shadow); }
        .main-content { flex:1; background:white; border-radius:1rem; box-shadow:var(--card-shadow); overflow:hidden; }

        /* ---------- User Profile ---------- */
        .user-profile{ display:flex; align-items:center; gap:1rem; padding-bottom:1.5rem; border-bottom:1px solid var(--border); margin-bottom:1.5rem; }
        .user-avatar{ width:60px; height:60px; border-radius:50%; background:linear-gradient(135deg,var(--primary),var(--secondary)); display:flex; align-items:center; justify-content:center; color:white; font-weight:700; font-size:1.5rem; }
        .user-info h3{ font-weight:600; margin-bottom:.25rem; }
        .user-info p{ color:var(--gray); font-size:.875rem; }
        .user-status{ display:flex; align-items:center; gap:.5rem; margin-top:.5rem; }
        .status-indicator{ width:8px; height:8px; border-radius:50%; background-color:var(--success); }
        .status-text{ font-size:.75rem; color:var(--success); }

        /* ---------- Options ---------- */
        .option-group{ margin-bottom:2rem; }
        .option-group-title{ font-size:.875rem; text-transform:uppercase; color:var(--gray); margin-bottom:1rem; letter-spacing:.5px; }
        .option-button{ display:flex; align-items:center; gap:1rem; width:100%; padding:1rem; background:none; border:1px solid var(--border); border-radius:.5rem; text-align:left; margin-bottom:.5rem; cursor:pointer; transition:all .3s; }
        .option-button:hover{ border-color:var(--primary); transform:translateY(-2px); box-shadow:var(--card-shadow); }
        .option-button.active{ background-color:rgba(67,97,238,0.1); border-color:var(--primary); }
        .option-icon{ font-size:1.25rem; width:24px; text-align:center; }
        .option-content{ flex:1; }
        .option-content h4{ font-weight:600; margin-bottom:.25rem; }
        .option-content p{ font-size:.875rem; color:var(--gray); }
        .option-badge{ background-color:var(--primary); color:white; font-size:.75rem; padding:.25rem .5rem; border-radius:50px; }

        /* ---------- Language ---------- */
        .language-grid{ display:grid; grid-template-columns:repeat(2,1fr); gap:.5rem; }
        .language-option{ display:flex; flex-direction:column; align-items:center; padding:1rem; border:1px solid var(--border); border-radius:.5rem; cursor:pointer; transition:all .3s; }
        .language-option:hover{ border-color:var(--primary); transform:translateY(-2px); box-shadow:var(--card-shadow); }
        .language-option.active{ background-color:rgba(67,97,238,0.1); border-color:var(--primary); }
        .language-flag{ font-size:1.5rem; margin-bottom:.5rem; }
        .language-name{ font-weight:600; margin-bottom:.25rem; }
        .language-code{ font-size:.75rem; color:var(--gray); }

        /* ---------- Chat Interface ---------- */
        .chat-header{ padding:1.5rem; border-bottom:1px solid var(--border); text-align:center; font-weight:600; }
        .chat-messages{ height:400px; overflow-y:auto; padding:1.5rem; display:flex; flex-direction:column; gap:1rem; }
        .message{ max-width:80%; padding:1rem; border-radius:1rem; word-break:break-word; }
        .message.ai{ align-self:flex-start; background-color:#f0f4ff; border-bottom-left-radius:.25rem; color:var(--dark); }
        .message.user{ align-self:flex-end; background-color:var(--primary); color:white; border-bottom-right-radius:.25rem; }
        .chat-input{ display:flex; padding:1rem; border-top:1px solid var(--border); gap:.5rem; }
        .chat-input input{ flex:1; padding:.75rem 1rem; border:1px solid var(--border); border-radius:.5rem; outline:none; }
        .chat-input input:focus{ border-color:var(--primary); }
        .chat-input button{ padding:.75rem 1.5rem; background-color:var(--primary); color:white; border:none; border-radius:.5rem; cursor:pointer; }
        .chat-input button:disabled { 
            background-color: var(--gray); 
            cursor: not-allowed; 
            opacity: 0.7; 
        }

        /* ---------- Features & Reviews (single, unified) ---------- */
        .features { background: linear-gradient(135deg,#f8f9fa 0%,#e9ecef 100%); }
        .features-grid { display:grid; grid-template-columns:1fr; gap:2rem; }
        @media(min-width:768px){ .features-grid { grid-template-columns:repeat(2,1fr); } }
        @media(min-width:992px){ .features-grid { grid-template-columns:repeat(3,1fr); } }
        .feature-card{ background:white; border-radius:1rem; padding:2rem; box-shadow:var(--card-shadow); transition:all .3s; }
        .feature-card:hover{ transform:translateY(-5px); box-shadow:var(--hover-shadow); }
        .feature-icon{ width:60px; height:60px; border-radius:1rem; background:linear-gradient(135deg,var(--primary),var(--secondary)); display:flex; align-items:center; justify-content:center; color:white; font-size:1.5rem; margin-bottom:1.5rem; }
        .feature-title{ font-size:1.25rem; font-weight:600; margin-bottom:1rem; }
        .feature-description{ color:var(--gray); margin-bottom:1.5rem; }
        .feature-details{ display:flex; flex-direction:column; gap:.5rem; }
        .feature-detail{ display:flex; align-items:center; gap:.5rem; font-size:.875rem; }
        .detail-bullet{ width:6px; height:6px; border-radius:50%; background-color:var(--primary); }

        /* Reviews */
        .reviews-grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:20px; }
        .review{ background:#f9f9f9; padding:20px; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,0.08); transition:transform .3s; }
        .review:hover{ transform:translateY(-5px); }
        .review p{ font-style:italic; margin-bottom:10px; color:var(--dark); }
        .review h4{ font-weight:bold; color:#444; margin-top:0; }

        /* ---------- Footer & Animations & Responsive ---------- */
        footer{ background-color:white; border-top:1px solid var(--border); padding:3rem 1rem; }
        .footer-content{ display:flex; flex-direction:column; align-items:center; gap:1.5rem; }
        .footer-logo{ display:flex; align-items:center; gap:.5rem; font-weight:700; font-size:1.5rem; color:var(--primary); }
        .footer-text{ text-align:center; color:var(--gray); }
        .footer-credits{ text-align:center; font-size:.875rem; color:var(--gray); }

        @keyframes slideUpFade { from{ opacity:0; transform:translateY(30px); } to{ opacity:1; transform:translateY(0); } }
        @keyframes pulseGlow { 0%,100%{ box-shadow:0 0 0 0 rgba(67,97,238,0.4); } 50%{ box-shadow:0 0 0 10px rgba(67,97,238,0); } }
        @keyframes float { 0%,100%{ transform:translateY(0); } 50%{ transform:translateY(-10px); } }
        .slide-up-fade{ animation:slideUpFade .8s ease-out forwards; }
        .pulse-glow{ animation:pulseGlow 2s infinite; }
        .float-animation{ animation:float 3s ease-in-out infinite; }

        /* Additional styles for rich content */
        .message a { color: var(--primary); text-decoration: underline; }
        .message img { max-width: 100%; height: auto; border-radius: 8px; }
        .message audio { width: 100%; margin-top: 10px; }
        
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container nav-container">
            <div class="logo"><i class="fas fa-brain"></i><span>EduNova</span></div>
            <nav class="nav-links" id="navLinks">
                <a href="#dashboard">Dashboard</a>
                <a href="#features">Features</a>
                <a href="#reviews">Reviews</a>
            </nav>
            <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Toggle navigation menu"><i class="fas fa-bars"></i></button>
        </div>
    </header>

    <!-- Hero -->
    <section class="hero">
        <div class="container hero-content">
            <div class="hero-badge slide-up-fade"><i class="fas fa-rocket"></i><span>AI-Powered Learning Platform</span></div>
            <h1 class="hero-title slide-up-fade" style="animation-delay:.1s;">Personalized Education for Every Student</h1>
            <p class="hero-subtitle slide-up-fade" style="animation-delay:.2s;">Experience adaptive learning ‚Äî AI tutoring, visual sketching, audio lessons, and smart textbooks powered by AWS AI services.</p>
            <div class="hero-actions slide-up-fade" style="animation-delay:.3s;">
                <a href="#dashboard" class="btn btn-primary pulse-glow"><i class="fas fa-sparkles"></i> Start Learning Now</a>
                <a href="#features" class="btn btn-secondary"><i class="fas fa-globe"></i> Explore Features</a>
            </div>
        </div>
    </section>

    <!-- Dashboard -->
    <section id="dashboard" class="section">
        <div class="container">
            <h2 class="section-title">Your Personal Learning Hub</h2>
            <p class="section-subtitle">Choose your preferred learning method and language. Our AI adapts to your style and pace for optimal learning outcomes.</p>

            <div class="dashboard">
                <!-- Sidebar -->
                <aside class="sidebar">
                    <div class="user-profile">
                        <div class="user-avatar">S</div>
                        <div class="user-info">
                            <h3>Sarah Lim</h3>
                            <p>Grade 10 Student</p>
                            <div class="user-status"><div class="status-indicator"></div><span class="status-text">Learning Active</span></div>
                        </div>
                    </div>

                    <div class="option-group">
                        <h4 class="option-group-title">Learning Methods</h4>
                        <button class="option-button active" data-format="chat" aria-pressed="true"><div class="option-icon">üí¨</div><div class="option-content"><h4>AI Tutor Chat</h4><p>One-on-one conversations with your personal AI tutor</p></div><span class="option-badge">Active</span></button>
                        <button class="option-button" data-format="ebook" aria-pressed="false"><div class="option-icon">üìñ</div><div class="option-content"><h4>Smart Textbooks</h4><p>Interactive digital textbooks that adapt to your progress</p></div></button>
                        <button class="option-button" data-format="sketch" aria-pressed="false"><div class="option-icon">‚úèÔ∏è</div><div class="option-content"><h4>Visual Learning</h4><p>Draw and visualize concepts for better understanding</p></div></button>
                        <button class="option-button" data-format="audio" aria-pressed="false"><div class="option-icon">üéß</div><div class="option-content"><h4>Audio Lessons</h4><p>Listen to AI-generated explanations and podcasts</p></div></button>
                        <button class="option-button" data-format="video" aria-pressed="false"><div class="option-icon">üé•</div><div class="option-content"><h4>Interactive Videos</h4><p>Watch educational videos with real-time interaction</p></div></button>
                    </div>

                    <div class="option-group">
                        <h4 class="option-group-title">Language</h4>
                        <div class="language-grid">
                            <div class="language-option active" data-lang="en" role="button" aria-pressed="true" aria-label="English"><div class="language-flag">üá∫üá∏</div><div class="language-name">English</div><div class="language-code">EN</div></div>
                            <div class="language-option" data-lang="ms" role="button" aria-pressed="false" aria-label="Malay"><div class="language-flag">üá≤üáæ</div><div class="language-name">Malay</div><div class="language-code">MS</div></div>
                            <div class="language-option" data-lang="zh" role="button" aria-pressed="false" aria-label="Chinese"><div class="language-flag">üá®üá≥</div><div class="language-name">Chinese</div><div class="language-code">ZH</div></div>
                            <div class="language-option" data-lang="ta" role="button" aria-pressed="false" aria-label="Tamil"><div class="language-flag">üáÆüá≥</div><div class="language-name">Tamil</div><div class="language-code">TA</div></div>
                        </div>
                    </div>
                </aside>

                <!-- Main content (chat) -->
                <main class="main-content">
                    <div class="chat-header" id="formatHeader">üí¨ AI Learning Assistant - Chat</div>

                    <div class="chat-messages" id="chatMessages">
                        <div class="message ai">Hello! I'm your AI tutor. I can help you understand complex topics through personalized explanations. What would you like to learn about today?</div>
                    </div>

                    <div class="chat-input">
                        <input type="text" id="userInput" placeholder="Ask me anything about your studies...">
                        <button id="sendButton" aria-label="Send message"><i class="fas fa-paper-plane"></i></button>
                    </div>
                </main>
            </div>
        </div>
    </section>

    <!-- Features (single, correct placement) -->
    <section id="features" class="section features">
        <div class="container">
            <h2 class="section-title">Why Choose EduNova?</h2>
            <p class="section-subtitle">Our AI-powered platform offers unique learning experiences tailored to different learning preferences and styles, ensuring every student can achieve their full potential.</p>

            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">üí¨</div>
                    <h3 class="feature-title">AI Tutor Chat</h3>
                    <p class="feature-description">Engage in personalized conversations with our advanced AI tutor that understands your learning style.</p>
                    <div class="feature-details">
                        <div class="feature-detail"><div class="detail-bullet"></div><span>Instant responses</span></div>
                        <div class="feature-detail"><div class="detail-bullet"></div><span>Personalized guidance</span></div>
                        <div class="feature-detail"><div class="detail-bullet"></div><span>Context-aware explanations</span></div>
                    </div>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">üìñ</div>
                    <h3 class="feature-title">Smart Textbooks</h3>
                    <p class="feature-description">Access comprehensive digital textbooks enhanced with interactive elements and embedded quizzes.</p>
                    <div class="feature-details">
                        <div class="feature-detail"><div class="detail-bullet"></div><span>Progress tracking</span></div>
                        <div class="feature-detail"><div class="detail-bullet"></div><span>Adaptive difficulty</span></div>
                        <div class="feature-detail"><div class="detail-bullet"></div><span>Interactive assessments</span></div>
                    </div>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">‚úèÔ∏è</div>
                    <h3 class="feature-title">Visual Learning</h3>
                    <p class="feature-description">Transform abstract concepts into visual representations using our intelligent drawing tools.</p>
                    <div class="feature-details">
                        <div class="feature-detail"><div class="detail-bullet"></div><span>Smart recognition</span></div>
                        <div class="feature-detail"><div class="detail-bullet"></div><span>Concept mapping</span></div>
                        <div class="feature-detail"><div class="detail-bullet"></div><span>Visual explanations</span></div>
                    </div>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">üéß</div>
                    <h3 class="feature-title">Audio Lessons</h3>
                    <p class="feature-description">Listen to AI-generated explanations and podcasts tailored to your learning preferences.</p>
                    <div class="feature-details">
                        <div class="feature-detail"><div class="detail-bullet"></div><span>Natural voice synthesis</span></div>
                        <div class="feature-detail"><div class="detail-bullet"></div><span>Multi-language support</span></div>
                        <div class="feature-detail"><div class="detail-bullet"></div><span>Adjustable pace</span></div>
                    </div>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">üé•</div>
                    <h3 class="feature-title">Interactive Videos</h3>
                    <p class="feature-description">Watch educational videos with real-time interaction and personalized content recommendations.</p>
                    <div class="feature-details">
                        <div class="feature-detail"><div class="detail-bullet"></div><span>Interactive quizzes</span></div>
                        <div class="feature-detail"><div class="detail-bullet"></div><span>Personalized content</span></div>
                        <div class="feature-detail"><div class="detail-bullet"></div><span>Progress tracking</span></div>
                    </div>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">üåê</div>
                    <h3 class="feature-title">Multi-Language Support</h3>
                    <p class="feature-description">Learn in your preferred language with seamless translation and localization features.</p>
                    <div class="feature-details">
                        <div class="feature-detail"><div class="detail-bullet"></div><span>Real-time translation</span></div>
                        <div class="feature-detail"><div class="detail-bullet"></div><span>Cultural adaptation</span></div>
                        <div class="feature-detail"><div class="detail-bullet"></div><span>Localized content</span></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Reviews -->
    <section id="reviews" class="section">
        <div class="container">
            <h2 class="section-title">What Learners Say</h2>
            <p class="section-subtitle">Trusted by students, professionals, and educators worldwide.</p>
            <div class="reviews-grid">
                <blockquote class="review"><p>"This AI learning platform made studying so much easier for me!"</p><cite>- Amina, Student</cite></blockquote>
                <blockquote class="review"><p>"Finally, a 24/7 tool that helps me practice and learn at my own pace."</p><cite>- Raj, Professional</cite></blockquote>
                <blockquote class="review"><p>"I love the multilingual support. It really feels inclusive."</p><cite>- Nur, Teacher</cite></blockquote>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container footer-content">
            <div class="footer-logo"><i class="fas fa-brain"></i><span>EduNova</span></div>
            <p class="footer-text">Proudly developed by <strong>404 ANF</strong></p>
            <p class="footer-credits">Built with AWS Bedrock, Lambda, Polly, and Translate<br>EduNova Educational Platform ¬© 2025</p>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        // Configuration
        const API_URL = 'https://hf2z7yvjfs43m3dldu3d2ic2im0pcswv.lambda-url.ap-southeast-1.on.aws/';
        const FORMAT_DISPLAY_NAMES = {
            'chat': 'Chat',
            'ebook': 'Smart Textbook',
            'sketch': 'Visual Learning',
            'audio': 'Audio Lesson',
            'video': 'Interactive Video'
        };

        // DOM references
        const chatMessages = document.getElementById('chatMessages');
        const userInput = document.getElementById('userInput');
        const sendButton = document.getElementById('sendButton');
        const optionButtons = document.querySelectorAll('.option-button');
        const languageOptions = document.querySelectorAll('.language-option');
        const navLinks = document.getElementById('navLinks');
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const formatHeader = document.getElementById('formatHeader');

        // State
        let currentFormat = 'chat';
        let currentLanguage = 'en';

        // Event binding
        document.addEventListener('DOMContentLoaded', function() {
            sendButton.addEventListener('click', sendMessage);
            userInput.addEventListener('keypress', function(e){ if(e.key === 'Enter') sendMessage(); });
            mobileMenuBtn.addEventListener('click', function() { 
                navLinks.classList.toggle('active'); 
                const isExpanded = navLinks.classList.contains('active');
                this.setAttribute('aria-expanded', isExpanded);
            });

            optionButtons.forEach(btn => {
                btn.addEventListener('click', function(){
                    const fmt = this.getAttribute('data-format');
                    setFormat(fmt);
                });
            });

            languageOptions.forEach(opt => {
                opt.addEventListener('click', function(){
                    const lang = this.getAttribute('data-lang');
                    setLanguage(lang);
                });
            });
        });

        function setFormat(format){
            currentFormat = format;
            optionButtons.forEach(button => {
                const buttonFormat = button.getAttribute('data-format');
                const isActive = buttonFormat === format;
                button.classList.toggle('active', isActive);
                button.setAttribute('aria-pressed', isActive);
                
                if(isActive){
                    if(!button.querySelector('.option-badge')){
                        const badgeEl = document.createElement('span');
                        badgeEl.className = 'option-badge';
                        badgeEl.textContent = 'Active';
                        button.appendChild(badgeEl);
                    }
                    // Update the main content header to reflect the chosen format
                    formatHeader.textContent = `üí¨ AI Learning Assistant - ${FORMAT_DISPLAY_NAMES[format] || format}`;
                    // Update input placeholder contextually
                    userInput.placeholder = getPlaceholderForFormat(format);
                } else {
                    const badge = button.querySelector('.option-badge');
                    if(badge) badge.remove();
                }
            });
        }

        function getPlaceholderForFormat(format) {
            const placeholders = {
                'chat': 'Ask me anything about your studies...',
                'ebook': 'Search in your textbook...',
                'sketch': 'Describe what you want to draw or learn...',
                'audio': 'What topic would you like to hear about?',
                'video': 'Search for a video topic...'
            };
            return placeholders[format] || 'Ask me anything...';
        }

        function setLanguage(lang){
            currentLanguage = lang;
            languageOptions.forEach(option => {
                const optionLang = option.getAttribute('data-lang');
                const isActive = optionLang === lang;
                option.classList.toggle('active', isActive);
                option.setAttribute('aria-pressed', isActive);
            });
        }

        // Helper to extract a simple topic (optional)
        function getTopicFromMessage(message){
            const topics = ['photosynthesis','water cycle','newton','algebra','geometry','chemistry'];
            for(const t of topics){
                if(message.toLowerCase().includes(t)) return t;
            }
            return '';
        }

        // Add message to chat (with HTML support)
        function addMessage(content, sender, isHTML = false){
            const el = document.createElement('div');
            el.className = 'message ' + sender;
            
            if (isHTML) {
                el.innerHTML = content; // Use innerHTML for rich content
            } else {
                el.textContent = content; // Use textContent for plain text
            }
            
            chatMessages.appendChild(el);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Main send function
        async function sendMessage(){
            const message = userInput.value.trim();
            if(!message) return;

            addMessage(message, 'user');
            userInput.value = '';
            
            // Disable button & input during request
            sendButton.disabled = true;
            userInput.disabled = true;
            sendButton.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i>';

            // Loading indicator in chat
            const loadingEl = document.createElement('div');
            loadingEl.className = 'message ai';
            loadingEl.innerHTML = '<i class="fas fa-circle-notch fa-spin" style="margin-right:8px;"></i>Thinking...';
            chatMessages.appendChild(loadingEl);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: message,
                        format: currentFormat,
                        language: currentLanguage,
                        topic: getTopicFromMessage(message)
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log("API Response:", data);
                loadingEl.remove();

                if (data && data.type) {
                    // Handle different response types
                    if (data.type === 'chat') {
                        addMessage(data.reply, 'ai');
                    } 
                    else if (data.type === 'ebook') {
                        const ebookMessage = `${data.reply}<br><a href="${data.fileUrl}" target="_blank" style="color: var(--primary); text-decoration: underline; font-weight: 500;">üìñ Download Textbook</a>`;
                        addMessage(ebookMessage, 'ai', true);
                    }
                    else if (data.type === 'sketch') {
                        const sketchMessage = `${data.reply}<br><img src="${data.fileUrl}" style="max-width: 100%; border-radius: 8px; margin-top: 10px; border: 2px solid var(--border);">`;
                        addMessage(sketchMessage, 'ai', true);
                    }
                    else if (data.type === 'video') {
                        const videoMessage = `${data.reply}<br><a href="${data.fileUrl}" target="_blank" style="color: var(--primary); text-decoration: underline; font-weight: 500;">üé• Watch Video</a>`;
                        addMessage(videoMessage, 'ai', true);
                    }
                    else if (data.type === 'audio') {
                        // Check if we have a file URL or audio data
                        if (data.fileUrl) {
                            const audioMessage = `${data.reply}<br><audio controls style="width: 100%; margin-top: 10px; border-radius: 20px;"><source src="${data.fileUrl}" type="audio/mp3">Your browser does not support audio.</audio>`;
                            addMessage(audioMessage, 'ai', true);
                        } else if (data.audio) {
                            const audioMessage = `${data.reply}<br><audio controls style="width: 100%; margin-top: 10px; border-radius: 20px;"><source src="${data.audio}" type="audio/mp3">Your browser does not support audio.</audio>`;
                            addMessage(audioMessage, 'ai', true);
                        } else {
                            addMessage(data.reply, 'ai');
                        }
                    }
                
                    else {
                        addMessage(data.reply || 'Response received', 'ai');
                    }
                } else if (data && data.reply) {
                    // Fallback for backward compatibility
                    addMessage(data.reply, 'ai');
                } else {
                    const errorMsg = data?.error?.message || data?.error || "Sorry, I couldn't process your request. Please try again.";
                    addMessage(`‚ö†Ô∏è Error: ${errorMsg}`, 'ai');
                }
            } catch(err){
                loadingEl.remove();
                addMessage('‚ö†Ô∏è Network Error: Unable to connect to AI service. Please check your connection.', 'ai');
                console.error('Request failed:', err);
            } finally {
                // Re-enable button & input regardless of success/failure
                sendButton.disabled = false;
                userInput.disabled = false;
                sendButton.innerHTML = '<i class="fas fa-paper-plane"></i>';
                userInput.focus();
            }
        }
    </script>
</body>
</html>